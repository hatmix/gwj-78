[gd_scene load_steps=23 format=4 uid="uid://bycr21mgk8bn3"]

[ext_resource type="Script" path="res://game/enemies/drone/drone.gd" id="1_ry1n7"]
[ext_resource type="Texture2D" uid="uid://obaqax6kif5y" path="res://game/enemies/drone/assets/shadow.png" id="2_1dl6r"]
[ext_resource type="Texture2D" uid="uid://bmcbxghs4viyy" path="res://game/enemies/drone/assets/top_down_45_cone_back_32x32.png" id="2_k8n0g"]
[ext_resource type="Script" path="res://game/components/state/state_machine.gd" id="3_b1gwg"]
[ext_resource type="FontFile" uid="uid://cslcrejpjhg8f" path="res://assets/fonts/pixelFont-2-5x5-sproutLands.ttf" id="3_dyvb2"]
[ext_resource type="Texture2D" uid="uid://boxqycewo5c3j" path="res://game/enemies/drone/assets/top_down_45_cone_front_32x32.png" id="4_0166a"]
[ext_resource type="Script" path="res://game/enemies/drone/states/patrol.gd" id="4_y21gw"]
[ext_resource type="AudioStream" uid="uid://dmduauj4kxhbc" path="res://game/enemies/drone/assets/collect1.wav" id="5_fymge"]
[ext_resource type="Script" path="res://game/enemies/drone/states/track.gd" id="5_vmfby"]
[ext_resource type="AudioStream" uid="uid://bjwd0t7ib22nn" path="res://game/enemies/drone/assets/scanning.ogg" id="6_ah7xn"]
[ext_resource type="Script" path="res://game/enemies/drone/states/search.gd" id="6_eotgj"]
[ext_resource type="AudioStream" uid="uid://xbv3i1t2x02s" path="res://game/enemies/drone/assets/whimper.wav" id="7_j2hoy"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_0vm57"]
size = Vector2(10, 10)

[sub_resource type="CircleShape2D" id="CircleShape2D_72dqh"]
radius = 16.0

[sub_resource type="PortableCompressedTexture2D" id="PortableCompressedTexture2D_shu6c"]
_data = PackedByteArray("AAADAAUAAAABAAAAoAAAAIAAAAAoAwAAUklGRiADAABXRUJQVlA4TBMDAAAvn8AfEG+gJpKkWNDVKfjfmBAFxHggRG0kqW38MwgZIh8hV4XURJIUC7q6+FXwE6KAGA+EzH8AwHR1FSSGxOBHl68hR0PWW759B8fDs7FBkrTtbdvAjUNpxu0GHMhpWrlcoIFpSw3ddIzUK5BZMVWDXXoBeQJSJ3DVBXAZF376fyBuq4j+O3LbyJHk02zkhFeIK3r5PwwxGJIx9w6XjnFitPPSbdS6EnTIT9qJZiEqmhTskPxvc2pa8I94naRwXzTp+XOpfXPos/nnaPnkyM/TfjkeyBdeOZbfbm+rQbNDKeSIk3EcJHdiTBw2psiOhOz4XpV95CiQ4wA7SqrjcNgNiI4aO6jOgwI6SuygOivgiDrGxM4dqrk12XPu2GxOLJ5NuHdcaRtZO0t3ELNW0Oed2/150h3kGzXr/EbPirvW5Zl3pb61/tO3yxS1UX95+4rPOtfQ8ew51aVRqUbpswHHow/IoZHUpMC5rrTWuBbNYVLgyFLgijaRMz9P0xzZU+BQ6EJEH7DzgXxBdKgl4JASuCLoXH67va0GNIfELqojMSYOvXJ8Pyj7wFFhR9FHzoLqrIfdgOY4xI6a6qpK1AG/o2gu2jImbnZ0nDvWlnoKOKRjh1g8m3DvuFI3snYWZK0L1xV7OEt1WMvguktdrtsQ8g+GYZgJy0JYOgaM2F/UuprGECIs/0dlRlJAyCQRlqdUppgUzFtXuUZ33rUjmtRaA4kfjpZPjvw87ZfjgXzhlWP5rVJq0OyIE6pje5voUMbEIcmRsDu+V0UfOA6wo+R2HA67AXDU4zhozho6Dkqyo0BV2AGcUceYmN2hmh1b0LUme4rbsYkcS8AlFs8m3Duu1lnr2DGydvaKPRjNunZYK+4Wp9t0B3dZSHdwp6bpDu4kg+N/X67pDvavnY3u4K9Fd7Aen6fpDt4eyBea7GBt+e32thrQHawlxsQh3cHa96rsh8BRIMdB0WeuHnaD5g6xo+4GvB2U3YDq4C3qGBMHZAdva7KnAgYH5xbPxuC4VjaydhZkrcCOK3/U6ziaHcNxQ54AAA==")
size_override = Vector2(160, 128)

[sub_resource type="Animation" id="Animation_erdqq"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Visual:offset")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, -20)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimPlayerSfx2D:volume_db")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_1v5nm"]
resource_name = "patrolling"
length = 1.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Visual:offset")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.233333, 0.5, 0.766667, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, -20), Vector2(0, -19), Vector2(0, -20), Vector2(0, -21), Vector2(0, -20)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Visual:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = false
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
}

[sub_resource type="Animation" id="Animation_e2ito"]
resource_name = "start_search"
length = 0.3
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Visual:offset")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.0666667, 0.1, 0.166667, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, -20), Vector2(0, -22), Vector2(0, -20), Vector2(0, -22), Vector2(0, -20)]
}
tracks/1/type = "audio"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimPlayerSfx2D")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"clips": [{
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("5_fymge")
}],
"times": PackedFloat32Array(0)
}
tracks/1/use_blend = true
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("AnimPlayerSfx2D:volume_db")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [6.0]
}

[sub_resource type="Animation" id="Animation_cnijn"]
resource_name = "search_exit"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Visual:offset")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.333333, 0.766667, 0.833333, 0.9, 0.933333, 1),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, -20), Vector2(0, -17), Vector2(0, -16), Vector2(0, -21), Vector2(0, -16), Vector2(0, -21), Vector2(0, -20)]
}
tracks/1/type = "audio"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimPlayerSfx2D")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"clips": [{
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("7_j2hoy")
}],
"times": PackedFloat32Array(0)
}
tracks/1/use_blend = true
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("AnimPlayerSfx2D:volume_db")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_pr557"]
resource_name = "searching"
length = 1.8
loop_mode = 1
tracks/0/type = "audio"
tracks/0/imported = false
tracks/0/enabled = false
tracks/0/path = NodePath("AnimPlayerSfx2D")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"clips": [{
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}, {
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("6_ah7xn")
}],
"times": PackedFloat32Array(0, 0.249359, 0.499598, 0.749698, 1.00138, 1.25333, 1.56667)
}
tracks/0/use_blend = true
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = false
tracks/1/path = NodePath("AnimPlayerSfx2D:volume_db")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0.0]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Visual:frame")
tracks/2/interp = 1
tracks/2/loop_wrap = false
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
}

[sub_resource type="Animation" id="Animation_01c5a"]
length = 1.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Visual:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = false
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_e5d8y"]
_data = {
"RESET": SubResource("Animation_erdqq"),
"patrolling": SubResource("Animation_1v5nm"),
"search_enter": SubResource("Animation_e2ito"),
"search_exit": SubResource("Animation_cnijn"),
"searching": SubResource("Animation_pr557"),
"tracking": SubResource("Animation_01c5a")
}

[node name="Drone" type="CharacterBody2D"]
collision_layer = 18
collision_mask = 18
motion_mode = 1
script = ExtResource("1_ry1n7")
speed = 20.0

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -23)
shape = SubResource("RectangleShape2D_0vm57")

[node name="DetectArea2D" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 12
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="DetectArea2D"]
shape = SubResource("CircleShape2D_72dqh")

[node name="ScannerBack" type="Sprite2D" parent="."]
self_modulate = Color(1, 0.498039, 0.498039, 0.501961)
z_index = -1
texture = ExtResource("2_k8n0g")

[node name="Shadow" type="Sprite2D" parent="."]
texture = ExtResource("2_1dl6r")

[node name="Visual" type="Sprite2D" parent="."]
y_sort_enabled = true
texture_filter = 1
position = Vector2(0, -4)
texture = SubResource("PortableCompressedTexture2D_shu6c")
offset = Vector2(0, -20)
hframes = 5
vframes = 4
metadata/_aseprite_wizard_interface_config_ = {
"layer_section": true,
"pending_changes": {}
}
metadata/_aseprite_wizard_config_ = {
"embed_tex": true,
"i_mode": 0,
"keep_anim_length": false,
"layers": [],
"o_ex_p": "",
"o_folder": "",
"o_name": "",
"only_visible": true,
"player": "AnimationPlayer",
"slice": "",
"source": "res://game/enemies/drone/assets/enemy-patrol.aseprite"
}
metadata/_aseprite_wizard_source_file_hash_ = "c0a659e592e1c560567045a867d8e08d"

[node name="ScannerFront" type="Sprite2D" parent="."]
self_modulate = Color(1, 0.498039, 0.498039, 0.501961)
z_index = 1
texture = ExtResource("4_0166a")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_e5d8y")
}

[node name="AnimPlayerSfx2D" type="AudioStreamPlayer2D" parent="."]
max_distance = 200.0
attenuation = 2.0

[node name="VisibleOnScreenNotifier2D" type="VisibleOnScreenNotifier2D" parent="."]
position = Vector2(0, -18)
scale = Vector2(0.6, 0.8)

[node name="StateLabel" type="Label" parent="."]
unique_name_in_owner = true
z_index = 99
z_as_relative = false
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -30.5
offset_top = -50.0
offset_right = 30.5
offset_bottom = -27.0
grow_horizontal = 2
grow_vertical = 0
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_colors/font_outline_color = Color(0.921569, 0.921569, 0.921569, 1)
theme_override_constants/outline_size = 2
theme_override_fonts/font = ExtResource("3_dyvb2")
theme_override_font_sizes/font_size = 8
text = "State"
horizontal_alignment = 1

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("target", "initial_state")]
script = ExtResource("3_b1gwg")
target = NodePath("..")
initial_state = NodePath("Patrol")

[node name="Patrol" type="Node" parent="StateMachine"]
script = ExtResource("4_y21gw")

[node name="DirectionChangeTimer" type="Timer" parent="StateMachine/Patrol"]
wait_time = 5.0

[node name="Track" type="Node" parent="StateMachine"]
script = ExtResource("5_vmfby")

[node name="Search" type="Node" parent="StateMachine"]
script = ExtResource("6_eotgj")

[node name="PatrolPattern" type="Line2D" parent="StateMachine/Search"]
visible = false
points = PackedVector2Array(0, 0, 36, 0, 18, 30, -18, -30, 18, -30, -18, 30, -36, 0, 0, 0)
width = 2.0
